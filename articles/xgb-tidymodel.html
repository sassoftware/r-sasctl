<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>xgb-tidymodel • sasctl</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="xgb-tidymodel">
<meta property="og:description" content="sasctl">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">sasctl</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.7.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/xgb-tidymodel.html">xgb-tidymodel</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/sassoftware/r-sasctl" class="external-link">
    <span class="fa fa-github fa-lg"></span>
     
    
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>xgb-tidymodel</h1>
            
      
      
      <div class="hidden name"><code>xgb-tidymodel.Rmd</code></div>

    </div>

    
    
<p>R-sasctl has tools to help you create all the necessary files to
upload an R model successfully to SAS Viya Model Manager and be able to
take advantage of its many features.</p>
<div class="section level2">
<h2 id="simple-data-preparation">Simple data preparation<a class="anchor" aria-label="anchor" href="#simple-data-preparation"></a>
</h2>
<p>We will be using the well known home equity data set. We will be
transforming some empty character columns to the proper <code>NA</code>
format, and split the data</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://sassoftware.github.io/r-sasctl/">"sasctl"</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://tidymodels.tidymodels.org" class="external-link">"tidymodels"</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co">## download and prepare data</span></span>
<span><span class="va">hmeq</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="st">"https://support.sas.com/documentation/onlinedoc/viya/exampledatasets/hmeq.csv"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">hmeq</span><span class="op">[</span><span class="va">hmeq</span> <span class="op">==</span> <span class="st">""</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span><span class="va">hmeq</span><span class="op">$</span><span class="va">BAD</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">hmeq</span><span class="op">$</span><span class="va">BAD</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## split data</span></span>
<span><span class="va">hmeq_split</span> <span class="op">&lt;-</span> <span class="fu">initial_split</span><span class="op">(</span><span class="va">hmeq</span>, prop <span class="op">=</span> <span class="fl">.8</span>, strata <span class="op">=</span> <span class="st">"BAD"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">hmeqTrain</span> <span class="op">&lt;-</span> <span class="fu">training</span><span class="op">(</span><span class="va">hmeq_split</span><span class="op">)</span></span>
<span><span class="va">hmeqTest</span> <span class="op">&lt;-</span> <span class="fu">testing</span><span class="op">(</span><span class="va">hmeq_split</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="creating-the-model">Creating the Model<a class="anchor" aria-label="anchor" href="#creating-the-model"></a>
</h2>
<p>We will be using the tidymodels framework, which helps greatly
simplifing the model process and embedding pre and post processing to
the model. You can get more information about how to use it <a href="https://www.tidymodels.org/start/" class="external-link">here</a>.</p>
<p>This first model will be using a simple <a href="https://github.com/dmlc/xgboost" class="external-link">XGBoost</a> model for
classification. It requires you to have the <code>xgboost</code> package
installed, but you don’t have to deal if its specific features or
calling the library directly.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## set model specification</span></span>
<span><span class="va">xgb_spec</span> <span class="op">&lt;-</span> <span class="fu">boost_tree</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">set_engine</span><span class="op">(</span><span class="st">"xgboost"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">set_mode</span><span class="op">(</span><span class="st">"classification"</span><span class="op">)</span></span></code></pre></div>
<p>We will also create a “recipe”, which are data pre-processing steps.
In this case, whenever you score the model, it will automatically impute
if any data is missing and create dummies, which is a requirement for
xgboost.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## recipe for data transformation</span></span>
<span><span class="va">rec</span> <span class="op">&lt;-</span> <span class="fu">recipe</span><span class="op">(</span><span class="va">BAD</span> <span class="op">~</span> <span class="va">.</span> , data <span class="op">=</span> <span class="va">hmeqTrain</span><span class="op">)</span></span>
<span></span>
<span><span class="va">impute_rec</span> <span class="op">&lt;-</span> <span class="va">rec</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">step_impute_mode</span><span class="op">(</span><span class="fu">all_nominal_predictors</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">step_dummy</span><span class="op">(</span><span class="fu">all_nominal_predictors</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">step_impute_mean</span><span class="op">(</span><span class="fu">all_numeric_predictors</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">imp</span> <span class="op">&lt;-</span> <span class="fu">prep</span><span class="op">(</span><span class="va">impute_rec</span><span class="op">)</span></span>
<span><span class="va">imp</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Recipe</span> <span style="color: #00BBBB;">──────────────────────────────────────────────────────────────────────</span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── Inputs</span></span>
<span><span class="co">#&gt; Number of variables by role</span></span>
<span><span class="co">#&gt; outcome:    1</span></span>
<span><span class="co">#&gt; predictor: 12</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── Training information</span></span>
<span><span class="co">#&gt; Training data contained 4767 data points and 2076 incomplete rows.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── Operations</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">•</span> Mode imputation for: <span style="color: #0000BB;">REASON</span>, <span style="color: #0000BB;">JOB</span> | <span style="font-style: italic;">Trained</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">•</span> Dummy variables from: <span style="color: #0000BB;">REASON</span>, <span style="color: #0000BB;">JOB</span> | <span style="font-style: italic;">Trained</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">•</span> Mean imputation for: <span style="color: #0000BB;">LOAN</span>, <span style="color: #0000BB;">MORTDUE</span>, <span style="color: #0000BB;">VALUE</span>, <span style="color: #0000BB;">YOJ</span>, <span style="color: #0000BB;">DEROG</span>, <span style="color: #0000BB;">DELINQ</span>, ... | <span style="font-style: italic;">Trained</span></span></span></code></pre></div>
<p>Now we will combine the model and pre-processing in a workflow. It is
recommend to use a workflow because it allows you to add all the steps
required to transform the data to the required model format. Even if you
are not using and pre-processing, it you should add the model to a
workflow as a good practice, and the <code><a href="../reference/codegen.html">sasctl::codegen()</a></code> only
generates scoring code for workflow in the current version.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## creating the workflow</span></span>
<span><span class="va">glm_wf</span> <span class="op">&lt;-</span> <span class="fu">workflow</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">add_model</span><span class="op">(</span><span class="va">xgb_spec</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">add_recipe</span><span class="op">(</span><span class="va">impute_rec</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## fitting the model and the pre-processing</span></span>
<span><span class="va">xgb_fitted</span> <span class="op">&lt;-</span> <span class="va">glm_wf</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">fit</span><span class="op">(</span>data <span class="op">=</span> <span class="va">hmeqTrain</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">xgb_fitted</span></span>
<span><span class="co">#&gt; ══ Workflow [trained] ══════════════════════════════════════════════════════════</span></span>
<span><span class="co">#&gt; <span style="font-style: italic;">Preprocessor:</span> Recipe</span></span>
<span><span class="co">#&gt; <span style="font-style: italic;">Model:</span> boost_tree()</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── Preprocessor ────────────────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; 3 Recipe Steps</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; • step_impute_mode()</span></span>
<span><span class="co">#&gt; • step_dummy()</span></span>
<span><span class="co">#&gt; • step_impute_mean()</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── Model ───────────────────────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; ##### xgb.Booster</span></span>
<span><span class="co">#&gt; raw: 51.8 Kb </span></span>
<span><span class="co">#&gt; call:</span></span>
<span><span class="co">#&gt;   xgboost::xgb.train(params = list(eta = 0.3, max_depth = 6, gamma = 0, </span></span>
<span><span class="co">#&gt;     colsample_bytree = 1, colsample_bynode = 1, min_child_weight = 1, </span></span>
<span><span class="co">#&gt;     subsample = 1), data = x$data, nrounds = 15, watchlist = x$watchlist, </span></span>
<span><span class="co">#&gt;     verbose = 0, nthread = 1, objective = "binary:logistic")</span></span>
<span><span class="co">#&gt; params (as set within xgb.train):</span></span>
<span><span class="co">#&gt;   eta = "0.3", max_depth = "6", gamma = "0", colsample_bytree = "1", colsample_bynode = "1", min_child_weight = "1", subsample = "1", nthread = "1", objective = "binary:logistic", validate_parameters = "TRUE"</span></span>
<span><span class="co">#&gt; xgb.attributes:</span></span>
<span><span class="co">#&gt;   niter</span></span>
<span><span class="co">#&gt; callbacks:</span></span>
<span><span class="co">#&gt;   cb.evaluation.log()</span></span>
<span><span class="co">#&gt; # of features: 16 </span></span>
<span><span class="co">#&gt; niter: 15</span></span>
<span><span class="co">#&gt; nfeatures : 16 </span></span>
<span><span class="co">#&gt; evaluation_log:</span></span>
<span><span class="co">#&gt;     iter training_logloss</span></span>
<span><span class="co">#&gt;        1        0.5235682</span></span>
<span><span class="co">#&gt;        2        0.4282722</span></span>
<span><span class="co">#&gt; ---                      </span></span>
<span><span class="co">#&gt;       14        0.1771351</span></span>
<span><span class="co">#&gt;       15        0.1744586</span></span></code></pre></div>
<p>Now we will start creating all the files required to successfully
upload the model to SAS Model Manager.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">path</span> <span class="op">&lt;-</span> <span class="st">"xgbModel/"</span></span>
<span><span class="va">modelrda</span> <span class="op">&lt;-</span> <span class="st">"Rxgb.rda"</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="va">path</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in dir.create(path): 'xgbModel' already exists</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">xgb_fitted</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">path</span>, <span class="va">modelrda</span><span class="op">)</span>, version <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p>We will score the whole dataset, add the partitions so we can create
the Diagnostics json files. In parallel you can make any other file or
processes, but SAS model manager expects these specific files to be able
to execute its routines such as comparing models.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">scoreddf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">xgb_fitted</span>, new_data <span class="op">=</span> <span class="va">hmeq</span>, type <span class="op">=</span> <span class="st">"prob"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">scoreddf</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 2</span></span></span>
<span><span class="co">#&gt;   .pred_0 .pred_1</span></span>
<span><span class="co">#&gt;     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>   0.111   0.889</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>   0.135   0.865</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>   0.175   0.825</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>   0.513   0.487</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>   0.537   0.463</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>   0.392   0.608</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">scoreddf</span><span class="op">$</span><span class="va">partition</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span><span class="va">scoreddf</span><span class="op">[</span><span class="va">hmeq_split</span><span class="op">$</span><span class="va">in_id</span>,<span class="op">]</span><span class="op">[</span><span class="st">"partition"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">scoreddf</span><span class="op">[</span><span class="op">-</span><span class="va">hmeq_split</span><span class="op">$</span><span class="va">in_id</span>,<span class="op">]</span><span class="op">[</span><span class="st">"partition"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span></span>
<span><span class="va">scoreddf</span><span class="op">$</span><span class="va">BAD</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">hmeq</span><span class="op">$</span><span class="va">BAD</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">scoreddf</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"P_BAD0"</span>, <span class="st">"P_BAD1"</span>, <span class="st">"partition"</span>, <span class="st">"BAD"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">scoreddf</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 4</span></span></span>
<span><span class="co">#&gt;   P_BAD0 P_BAD1 partition   BAD</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>  0.111  0.889         1     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>  0.135  0.865         1     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>  0.175  0.825         2     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>  0.513  0.487         1     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>  0.537  0.463         1     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>  0.392  0.608         1     1</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">diags</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/diagnosticsJson.html">diagnosticsJson</a></span><span class="op">(</span>traindf <span class="op">=</span> <span class="va">scoreddf</span><span class="op">[</span><span class="va">scoreddf</span><span class="op">$</span><span class="va">partition</span> <span class="op">==</span> <span class="fl">1</span>,<span class="op">]</span>,</span>
<span>                         testdf <span class="op">=</span> <span class="va">scoreddf</span><span class="op">[</span><span class="va">scoreddf</span><span class="op">$</span><span class="va">partition</span> <span class="op">==</span> <span class="fl">2</span>,<span class="op">]</span>,</span>
<span>                         targetEventValue <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                         targetName <span class="op">=</span> <span class="st">"BAD"</span>,</span>
<span>                         targetPredicted <span class="op">=</span> <span class="st">"P_BAD1"</span>,</span>
<span>                         path <span class="op">=</span> <span class="va">path</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "File written to xgbModel/dmcas_lift.json"</span></span>
<span><span class="co">#&gt; [1] "File written to xgbModel/dmcas_roc.json"</span></span>
<span><span class="co">#&gt; [1] "File written to xgbModel/dmcas_fitstat.json"</span></span>
<span></span>
<span><span class="co">## This is not very legible, but gives an idea of all the data created</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">diags</span><span class="op">$</span><span class="va">fitStat</span><span class="op">$</span><span class="va">parameterMap</span>, <span class="va">as.data.frame</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;                                 parameter type                      label</span></span>
<span><span class="co">#&gt; _RASE_                             _RASE_  num Root Average Squared Error</span></span>
<span><span class="co">#&gt; _NObs_                             _NObs_  num         Sum of Frequencies</span></span>
<span><span class="co">#&gt; _GINI_                             _GINI_  num           Gini Coefficient</span></span>
<span><span class="co">#&gt; _GAMMA_                           _GAMMA_  num                      Gamma</span></span>
<span><span class="co">#&gt; _formattedPartition_ _formattedPartition_ char        Formatted Partition</span></span>
<span><span class="co">#&gt; _DataRole_                     _DataRole_ char                  Data Role</span></span>
<span><span class="co">#&gt; _MCE_                               _MCE_  num     Misclassification Rate</span></span>
<span><span class="co">#&gt; _ASE_                               _ASE_  num      Average Squared Error</span></span>
<span><span class="co">#&gt; _MCLL_                             _MCLL_  num       Multi-Class Log Loss</span></span>
<span><span class="co">#&gt; _KS_                                 _KS_  num                KS (Youden)</span></span>
<span><span class="co">#&gt; _KSPostCutoff_             _KSPostCutoff_  num             ROC Separation</span></span>
<span><span class="co">#&gt; _DIV_                               _DIV_  num            Divisor for ASE</span></span>
<span><span class="co">#&gt; _TAU_                               _TAU_  num                        Tau</span></span>
<span><span class="co">#&gt; _KSCut_                           _KSCut_  num                  KS Cutoff</span></span>
<span><span class="co">#&gt; _C_                                   _C_  num             Area Under ROC</span></span>
<span><span class="co">#&gt; _PartInd_                       _PartInd_  num        Partition Indicator</span></span>
<span><span class="co">#&gt; _TargetName_                 _TargetName_ char                Target Name</span></span>
<span><span class="co">#&gt;                      length order               values preformatted</span></span>
<span><span class="co">#&gt; _RASE_                    8     7               _RASE_        FALSE</span></span>
<span><span class="co">#&gt; _NObs_                    8     4               _NObs_        FALSE</span></span>
<span><span class="co">#&gt; _GINI_                    8    12               _GINI_        FALSE</span></span>
<span><span class="co">#&gt; _GAMMA_                   8    13              _GAMMA_        FALSE</span></span>
<span><span class="co">#&gt; _formattedPartition_     12     3 _formattedPartition_        FALSE</span></span>
<span><span class="co">#&gt; _DataRole_               10     1           _DataRole_        FALSE</span></span>
<span><span class="co">#&gt; _MCE_                     8     8                _MCE_        FALSE</span></span>
<span><span class="co">#&gt; _ASE_                     8     5                _ASE_        FALSE</span></span>
<span><span class="co">#&gt; _MCLL_                    8     9               _MCLL_        FALSE</span></span>
<span><span class="co">#&gt; _KS_                      8    10                 _KS_        FALSE</span></span>
<span><span class="co">#&gt; _KSPostCutoff_            8    16       _KSPostCutoff_        FALSE</span></span>
<span><span class="co">#&gt; _DIV_                     8     6                _DIV_        FALSE</span></span>
<span><span class="co">#&gt; _TAU_                     8    14                _TAU_        FALSE</span></span>
<span><span class="co">#&gt; _KSCut_                   8    15              _KSCut_        FALSE</span></span>
<span><span class="co">#&gt; _C_                       8    11                  _C_        FALSE</span></span>
<span><span class="co">#&gt; _PartInd_                 8     2            _PartInd_        FALSE</span></span>
<span><span class="co">#&gt; _TargetName_             10     1         _TargetName_        FALSE</span></span></code></pre></div>
<p>Scoring codes are required to run R and Python models in SAS Model
Manager, <code><a href="../reference/codegen.html">sasctl::codegen()</a></code> helps you create a code that
follows the <a href="https://go.documentation.sas.com/doc/en/mdlmgrcdc/v_025/mdlmgrug/n04i7s6bdu7ilgn1e350am3byuxx.htm#p0m6jg3tgih1agn1cgdcexpwgp0g" class="external-link">expected
format</a> for tidymodels workflows. Other models and frameworks may be
added in the future.</p>
<p>You will notice that the scoring code has many <code>EM_*</code> and
<code>P_&lt;&lt;target&gt;&gt;&lt;&lt;level&gt;&gt;</code> variables.
They’re not required, but it makes very consistent on how models made in
SAS Viya UI are created. Making it easier to mix these models.</p>
</div>
<div class="section level2">
<h2 id="generating-the-score-code">Generating the Score code<a class="anchor" aria-label="anchor" href="#generating-the-score-code"></a>
</h2>
<p>We can use the <code>inputs</code> to generate alternate input
variables. In this case it is useful because we used the pre-process
step <code><a href="https://recipes.tidymodels.org/reference/step_dummy.html" class="external-link">recipes::step_dummy()</a></code> which created additional dummy
variables which arend expected when scoring the model nor we want to
pollute our Model Manager with dummy variables:</p>
<ul>
<li>Model Variables: <code>LOAN</code>, <code>MORTDUE</code>,
<code>VALUE</code>, <code>YOJ</code>, <code>DEROG</code>,
<code>DELINQ</code>, <code>CLAGE</code>, <code>NINQ</code>,
<code>CLNO</code>, <code>DEBTINC</code>, <code>REASON_HomeImp</code>,
<code>JOB_Office</code>, <code>JOB_Other</code>,
<code>JOB_ProfExe</code>, <code>JOB_Sales</code>,
<code>JOB_Self</code>
</li>
<li>Input Variables: <code>LOAN</code>, <code>MORTDUE</code>,
<code>VALUE</code>, <code>REASON</code>, <code>JOB</code>,
<code>YOJ</code>, <code>DEROG</code>, <code>DELINQ</code>,
<code>CLAGE</code>, <code>NINQ</code>, <code>CLNO</code>,
<code>DEBTINC</code> (removing the <code>BAD</code> variable, of
course).</li>
</ul>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">code</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/codegen.html">codegen</a></span><span class="op">(</span><span class="va">xgb_fitted</span>, </span>
<span>                path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">path</span>, <span class="st">"scoreCode.R"</span><span class="op">)</span>, </span>
<span>                inputs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">hmeq</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>                referenceLevel <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                rds <span class="op">=</span> <span class="va">modelrda</span><span class="op">)</span></span>
<span><span class="co">#&gt; File written to: xgbModel/scoreCode.R</span></span>
<span><span class="va">code</span></span>
<span><span class="co">#&gt; library("tidymodels")</span></span>
<span><span class="co">#&gt; library("xgboost")</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; scoreFunction &lt;- function(LOAN, MORTDUE, VALUE, REASON, JOB, YOJ, DEROG, DELINQ, CLAGE, NINQ, CLNO, DEBTINC)</span></span>
<span><span class="co">#&gt; {</span></span>
<span><span class="co">#&gt;   #output: EM_CLASSIFICATION, EM_EVENTPROBABILITY, EM_PROBABILITY, I_BAD, BAD, P_BAD0, P_BAD1</span></span>
<span><span class="co">#&gt;   </span></span>
<span><span class="co">#&gt;   if (!exists("sasctlRmodel"))</span></span>
<span><span class="co">#&gt;   {</span></span>
<span><span class="co">#&gt;     assign("sasctlRmodel", readRDS(file = paste(rdsPath, "Rxgb.rda", sep = "")), envir = .GlobalEnv)</span></span>
<span><span class="co">#&gt;     </span></span>
<span><span class="co">#&gt;   }</span></span>
<span><span class="co">#&gt;   target_labels &lt;- c('0', '1')</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   data &lt;- data.frame(LOAN  =  LOAN,</span></span>
<span><span class="co">#&gt;                      MORTDUE  =  MORTDUE,</span></span>
<span><span class="co">#&gt;                      VALUE  =  VALUE,</span></span>
<span><span class="co">#&gt;                      REASON  =  REASON,</span></span>
<span><span class="co">#&gt;                      JOB  =  JOB,</span></span>
<span><span class="co">#&gt;                      YOJ  =  YOJ,</span></span>
<span><span class="co">#&gt;                      DEROG  =  DEROG,</span></span>
<span><span class="co">#&gt;                      DELINQ  =  DELINQ,</span></span>
<span><span class="co">#&gt;                      CLAGE  =  CLAGE,</span></span>
<span><span class="co">#&gt;                      NINQ  =  NINQ,</span></span>
<span><span class="co">#&gt;                      CLNO  =  CLNO,</span></span>
<span><span class="co">#&gt;                      DEBTINC  =  DEBTINC)</span></span>
<span><span class="co">#&gt;   </span></span>
<span><span class="co">#&gt;   predictions &lt;- predict(sasctlRmodel, new_data = data, type = "prob")</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   boolClass &lt;- (predictions == do.call(pmax, predictions))</span></span>
<span><span class="co">#&gt; predictions[".pred"] &lt;- apply(boolClass, 1 , function(x) target_labels[x])</span></span>
<span><span class="co">#&gt;   </span></span>
<span><span class="co">#&gt; output_list &lt;- list(EM_CLASSIFICATION = predictions[[".pred"]], </span></span>
<span><span class="co">#&gt;                     EM_EVENTPROBABILITY = predictions[[".pred_1"]],</span></span>
<span><span class="co">#&gt;                     EM_PROBABILITY = apply(subset(predictions, select = -c(.pred)), 1, max),</span></span>
<span><span class="co">#&gt;                     I_BAD = predictions[[".pred"]],</span></span>
<span><span class="co">#&gt;                     BAD = predictions[[".pred"]],</span></span>
<span><span class="co">#&gt;                     P_BAD0 = predictions[[".pred_0"]],</span></span>
<span><span class="co">#&gt;                     P_BAD1 = predictions[[".pred_1"]]</span></span>
<span><span class="co">#&gt;                     )</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   return(output_list)</span></span>
<span><span class="co">#&gt; }</span></span></code></pre></div>
<div class="section level3">
<h3 id="testing-the-scoring-code">Testing the scoring code<a class="anchor" aria-label="anchor" href="#testing-the-scoring-code"></a>
</h3>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">## getting the .rda Path to be called in the function</span></span>
<span><span class="co">## this is simulating what Viya passes to R when calling it</span></span>
<span><span class="va">rdsPath</span> <span class="op">&lt;-</span> <span class="va">path</span></span>
<span></span>
<span><span class="co">## Calling the generated code string as code to</span></span>
<span><span class="co">## create the function locally</span></span>
<span><span class="va">codeExpression</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/parse.html" class="external-link">str2expression</a></span><span class="op">(</span><span class="va">code</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/eval.html" class="external-link">eval</a></span><span class="op">(</span><span class="va">codeExpression</span><span class="op">)</span> </span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'xgboost'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:dplyr':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     slice</span></span>
<span></span>
<span><span class="co">## this is a helper to create the variables</span></span>
<span><span class="co">## cat(paste0(colnames(hmeq)[-1], " = hmeq[, '", colnames(hmeq)[-1],"']", collapse = ",\n " ))</span></span>
<span></span>
<span><span class="va">scoreRes</span> <span class="op">&lt;-</span> <span class="fu">scoreFunction</span><span class="op">(</span>LOAN <span class="op">=</span> <span class="va">hmeq</span><span class="op">[</span>, <span class="st">'LOAN'</span><span class="op">]</span>,</span>
<span>                          MORTDUE <span class="op">=</span> <span class="va">hmeq</span><span class="op">[</span>, <span class="st">'MORTDUE'</span><span class="op">]</span>,</span>
<span>                          VALUE <span class="op">=</span> <span class="va">hmeq</span><span class="op">[</span>, <span class="st">'VALUE'</span><span class="op">]</span>,</span>
<span>                          REASON <span class="op">=</span> <span class="va">hmeq</span><span class="op">[</span>, <span class="st">'REASON'</span><span class="op">]</span>,</span>
<span>                          JOB <span class="op">=</span> <span class="va">hmeq</span><span class="op">[</span>, <span class="st">'JOB'</span><span class="op">]</span>,</span>
<span>                          YOJ <span class="op">=</span> <span class="va">hmeq</span><span class="op">[</span>, <span class="st">'YOJ'</span><span class="op">]</span>,</span>
<span>                          DEROG <span class="op">=</span> <span class="va">hmeq</span><span class="op">[</span>, <span class="st">'DEROG'</span><span class="op">]</span>,</span>
<span>                          DELINQ <span class="op">=</span> <span class="va">hmeq</span><span class="op">[</span>, <span class="st">'DELINQ'</span><span class="op">]</span>,</span>
<span>                          CLAGE <span class="op">=</span> <span class="va">hmeq</span><span class="op">[</span>, <span class="st">'CLAGE'</span><span class="op">]</span>,</span>
<span>                          NINQ <span class="op">=</span> <span class="va">hmeq</span><span class="op">[</span>, <span class="st">'NINQ'</span><span class="op">]</span>,</span>
<span>                          CLNO <span class="op">=</span> <span class="va">hmeq</span><span class="op">[</span>, <span class="st">'CLNO'</span><span class="op">]</span>,</span>
<span>                          DEBTINC <span class="op">=</span> <span class="va">hmeq</span><span class="op">[</span>, <span class="st">'DEBTINC'</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="va">scoreRes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">scoreRes</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">scoreRes</span><span class="op">)</span></span>
<span><span class="co">#&gt;   EM_CLASSIFICATION EM_EVENTPROBABILITY EM_PROBABILITY I_BAD BAD    P_BAD0</span></span>
<span><span class="co">#&gt; 1                 1           0.8886101      0.8886101     1   1 0.1113899</span></span>
<span><span class="co">#&gt; 2                 1           0.8648998      0.8648998     1   1 0.1351002</span></span>
<span><span class="co">#&gt; 3                 1           0.8245663      0.8245663     1   1 0.1754337</span></span>
<span><span class="co">#&gt; 4                 0           0.4872415      0.5127585     0   0 0.5127585</span></span>
<span><span class="co">#&gt; 5                 0           0.4634512      0.5365488     0   0 0.5365488</span></span>
<span><span class="co">#&gt; 6                 1           0.6075494      0.6075494     1   1 0.3924506</span></span>
<span><span class="co">#&gt;      P_BAD1</span></span>
<span><span class="co">#&gt; 1 0.8886101</span></span>
<span><span class="co">#&gt; 2 0.8648998</span></span>
<span><span class="co">#&gt; 3 0.8245663</span></span>
<span><span class="co">#&gt; 4 0.4872415</span></span>
<span><span class="co">#&gt; 5 0.4634512</span></span>
<span><span class="co">#&gt; 6 0.6075494</span></span></code></pre></div>
<p>Now we create some additional files which are required to configure
SAS Model Manager when uploading the files. For the variables
specifically, should match the inputs from the model and outputs. We can
use the result from the scoring code test from the previous chunck.
Otherwise you can create a <code>data.frame</code> with the expected
outputs and pass it.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="../reference/write_in_out_json.html">write_in_out_json</a></span><span class="op">(</span><span class="va">hmeq</span><span class="op">[</span>,<span class="op">-</span><span class="fl">1</span><span class="op">]</span>, input <span class="op">=</span> <span class="cn">TRUE</span>, path <span class="op">=</span> <span class="va">path</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "File written to xgbModel/inputVar.json"</span></span>
<span><span class="co">#&gt;       name length    type    level  role</span></span>
<span><span class="co">#&gt; 1     LOAN      8 decimal interval input</span></span>
<span><span class="co">#&gt; 2  MORTDUE      8 decimal interval input</span></span>
<span><span class="co">#&gt; 3    VALUE      8 decimal interval input</span></span>
<span><span class="co">#&gt; 4   REASON      7  string  nominal input</span></span>
<span><span class="co">#&gt; 5      JOB      7  string  nominal input</span></span>
<span><span class="co">#&gt; 6      YOJ      8 decimal interval input</span></span>
<span><span class="co">#&gt; 7    DEROG      8 decimal interval input</span></span>
<span><span class="co">#&gt; 8   DELINQ      8 decimal interval input</span></span>
<span><span class="co">#&gt; 9    CLAGE      8 decimal interval input</span></span>
<span><span class="co">#&gt; 10    NINQ      8 decimal interval input</span></span>
<span><span class="co">#&gt; 11    CLNO      8 decimal interval input</span></span>
<span><span class="co">#&gt; 12 DEBTINC      8 decimal interval input</span></span>
<span><span class="fu"><a href="../reference/write_in_out_json.html">write_in_out_json</a></span><span class="op">(</span><span class="va">scoreRes</span>, input <span class="op">=</span> <span class="cn">FALSE</span>, path <span class="op">=</span> <span class="va">path</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "File written to xgbModel/outputVar.json"</span></span>
<span><span class="co">#&gt;                  name length    type    level   role</span></span>
<span><span class="co">#&gt; 1   EM_CLASSIFICATION      1  string  nominal output</span></span>
<span><span class="co">#&gt; 2 EM_EVENTPROBABILITY      8 decimal interval output</span></span>
<span><span class="co">#&gt; 3      EM_PROBABILITY      8 decimal interval output</span></span>
<span><span class="co">#&gt; 4               I_BAD      1  string  nominal output</span></span>
<span><span class="co">#&gt; 5                 BAD      1  string  nominal output</span></span>
<span><span class="co">#&gt; 6              P_BAD0      8 decimal interval output</span></span>
<span><span class="co">#&gt; 7              P_BAD1      8 decimal interval output</span></span>
<span></span>
<span><span class="fu"><a href="../reference/write_fileMetadata_json.html">write_fileMetadata_json</a></span><span class="op">(</span>scoreCodeName <span class="op">=</span> <span class="st">"scoreCode.R"</span>,</span>
<span>                        scoreResource <span class="op">=</span> <span class="va">modelrda</span>,</span>
<span>                        path <span class="op">=</span> <span class="va">path</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "File written to xgbModel/fileMetadata.json"</span></span>
<span><span class="co">#&gt;              role           name</span></span>
<span><span class="co">#&gt; 1  inputVariables  inputVar.json</span></span>
<span><span class="co">#&gt; 2 outputVariables outputVar.json</span></span>
<span><span class="co">#&gt; 3           score    scoreCode.R</span></span>
<span><span class="co">#&gt; 4   scoreResource       Rxgb.rda</span></span>
<span></span>
<span><span class="fu"><a href="../reference/write_ModelProperties_json.html">write_ModelProperties_json</a></span><span class="op">(</span>modelName <span class="op">=</span> <span class="st">"Rxgb"</span>,</span>
<span>                           modelFunction <span class="op">=</span> <span class="st">"Classification"</span>,</span>
<span>                           trainTable <span class="op">=</span> <span class="st">"hmeq"</span>,</span>
<span>                           algorithm <span class="op">=</span> <span class="st">"XGBoost"</span>,</span>
<span>                           numTargetCategories <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                           targetEvent <span class="op">=</span> <span class="st">"1"</span>,</span>
<span>                           targetVariable <span class="op">=</span> <span class="st">"BAD"</span>,</span>
<span>                           eventProbVar <span class="op">=</span> <span class="st">"P_BAD1"</span>,</span>
<span>                           modeler <span class="op">=</span> <span class="st">"sasctl man"</span>,</span>
<span>                           path <span class="op">=</span> <span class="va">path</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "File written to xgbModel/ModelProperties.json"</span></span>
<span><span class="co">#&gt;                         value</span></span>
<span><span class="co">#&gt; name                     Rxgb</span></span>
<span><span class="co">#&gt; description           R model</span></span>
<span><span class="co">#&gt; function       Classification</span></span>
<span><span class="co">#&gt; scoreCodeType               R</span></span>
<span><span class="co">#&gt; trainTable               hmeq</span></span>
<span><span class="co">#&gt; trainCodeType               R</span></span>
<span><span class="co">#&gt; algorithm             XGBoost</span></span>
<span><span class="co">#&gt; targetVariable            BAD</span></span>
<span><span class="co">#&gt; targetEvent                 1</span></span>
<span><span class="co">#&gt; targetLevel            Binary</span></span>
<span><span class="co">#&gt; eventProbVar           P_BAD1</span></span>
<span><span class="co">#&gt; modeler            sasctl man</span></span>
<span><span class="co">#&gt; tool                        R</span></span>
<span><span class="co">#&gt; toolVersion             4.3.1</span></span>
<span></span>
<span><span class="va">files_to_zip</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="va">path</span>, <span class="st">"*.json|*.R|*.rda"</span>, full.names <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span></span>
<span><span class="co">### grouping all the files to a single zip</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/zip.html" class="external-link">zip</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">path</span>, <span class="st">"Rmodel.zip"</span><span class="op">)</span>, </span>
<span>    files <span class="op">=</span> <span class="va">files_to_zip</span><span class="op">)</span></span></code></pre></div>
<p>Finally, we can upload the model to our SAS Viya server.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sess</span> <span class="op">&lt;-</span> <span class="fu">sasctl</span><span class="fu">::</span><span class="fu"><a href="../reference/session.html">session</a></span><span class="op">(</span><span class="st">"https://viya.server.com"</span>,</span>
<span>                        username <span class="op">=</span> <span class="st">"username"</span>,</span>
<span>                        password <span class="op">=</span> <span class="st">"s3cr3t!"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/register_model.html">register_model</a></span><span class="op">(</span></span>
<span>  session <span class="op">=</span> <span class="va">sess</span>,</span>
<span>  file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">path</span>, <span class="st">"Rmodel.zip"</span><span class="op">)</span>,</span>
<span>  name <span class="op">=</span> <span class="st">"Rxgb"</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"zip"</span>,</span>
<span>  project <span class="op">=</span> <span class="st">"R_sasctl"</span>,</span>
<span>  force <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## deleting the files locally</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/unlink.html" class="external-link">unlink</a></span><span class="op">(</span><span class="va">path</span>, recursive <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Eduardo Hellas, <a href="https://www.sas.com" class="external-link"><img src="reference/figures/SAS_logo.png" alt="SAS" width="72"></a>.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
